{
  "type": "aws",
  "httpMethod": "POST",
  "uri": "arn:aws:apigateway:${AWS_REGION}:dynamodb:action/Query",
  "credentials": "${API_GATEWAY_DYNAMODB_ROLE}",
  "responses": {
    "default": {
      "statusCode": "200",
      "responseParameters": {
        "method.response.header.Access-Control-Allow-Methods": "'GET'",
        "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
        "method.response.header.Access-Control-Allow-Origin": "'*'"
      },
      "responseTemplates": {
        "application/json": "#set($inputRoot = $input.path('$'))\r\n#if($inputRoot.Items.size() == 0)\r\n{\r\n \"success\": false,\r\n \"message\": \"No donations found\"\r\n}\r\n#set($context.responseOverride.status = 404)\r\n#else\r\n{\r\n \"success\": true,\r\n \"data\": [\r\n #foreach($item in $inputRoot.Items)\r\n #if($item.SK.S.startsWith('BLOOD_REQ#'))\r\n {\r\n \"reqPostId\": \"$item.SK.S.split('#')[2]\",\r\n \"patientName\": \"$item.patientName.S\",\r\n \"neededBloodGroup\": \"$item.neededBloodGroup.S\",\r\n \"bloodQuantity\": \"$item.bloodQuantity.N\",\r\n \"urgencyLevel\": \"$item.urgencyLevel.S\",\r\n \"city\": \"$item.city.S\",\r\n \"location\": \"$item.location.S\",\r\n \"longitude\": \"$item.longitude.N\",\r\n \"latitude\": \"$item.latitude.N\",\r\n \"donationDateTime\": \"$item.donationDateTime.S\",\r\n \"contactNumber\": \"$item.contactNumber.S\",\r\n \"transportationInfo\": \"$item.transportationInfo.S\",\r\n \"shortDescription\": \"$item.shortDescription.S\",\r\n \"status\": \"$item.status.S\",\r\n \"createdAt\": \"$item.createdAt.S\",\r\n \"acceptedDonors\": [\r\n #foreach($acceptedItem in $inputRoot.Items)\r\n #if($acceptedItem.SK.S.startsWith('ACCEPTED#') && $acceptedItem.PK.S == $item.PK.S)\r\n #set($acceptedReqPostID = $acceptedItem.SK.S.split('#')[1])\r\n #if($acceptedReqPostID == $item.SK.S.split('#')[1])\r\n {\r\n \"reqPostID\": \"$acceptedReqPostID\",\r\n \"donorULID\": \"$acceptedItem.SK.S.split('#')[2]\"\r\n }#if($foreach.hasNext),#end\r\n #end\r\n #end\r\n #end\r\n ]\r\n }#if($foreach.hasNext),#end\r\n #end\r\n #end\r\n  ],\r\n \"message\": \"Donations retrieved successfully\"\r\n}\r\n#end"
      }
    }
  },
  "requestTemplates": {
    "application/json": "{\n \"TableName\": \"${DYNAMODB_TABLE_NAME}\",\n \"KeyConditionExpression\": \"PK = :PK\",\n \"ExpressionAttributeValues\": {\n \":PK\": {\"S\": \"BLOOD_REQ#$context.authorizer.claims['custom:userId']\"}\n },\n \"ScanIndexForward\": false\n}"
  },
  "passthroughBehavior": "never"
}